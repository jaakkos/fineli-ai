# Render Blueprint: Fineli AI + free PostgreSQL
# https://render.com/docs/blueprint-spec

databases:
  - name: fineli-db
    plan: free
    databaseName: fineli

services:
  - type: web
    name: fineli-ai
    runtime: node
    plan: free

    buildCommand: pnpm install --frozen-lockfile --prod=false && pnpm db:push && pnpm db:seed && pnpm build
    startCommand: pnpm start

    envVars:
      - key: SESSION_SECRET
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: fineli-db
          property: connectionString
      - key: NODE_ENV
        value: production
      # Set NEXT_PUBLIC_APP_URL to your Render service URL (e.g. https://fineli-ai.onrender.com)
      # Required for magic link emails to point to the correct URL.
      # - key: NEXT_PUBLIC_APP_URL
      #   value: https://fineli-ai.onrender.com
      # Magic-link only: uncomment and set these for production login
      # - key: REQUIRE_MAGIC_LINK
      #   value: "true"
      # - key: NEXT_PUBLIC_REQUIRE_MAGIC_LINK
      #   value: "true"
      # - key: RESEND_API_KEY
      #   value: re_xxxxx
